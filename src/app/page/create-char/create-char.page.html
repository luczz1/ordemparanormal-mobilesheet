<ion-content>
  <div class="menu">
    <ion-grid>
      <ion-row style="display: flex; align-items: center">
        <ion-col size="1" (click)="redirectToBackScreen()">
          <span style="font-size: 1.8em"
            ><ion-icon
              name="chevron-back-outline"
              style="margin-top: 0.4em"
            ></ion-icon
          ></span>
        </ion-col>
        <ion-col>
          <span style="font-size: 1.8em; font-family: SpecialFont"
            >{{editingMode ? 'Editar' : 'Criar'}} personagem</span
          >
        </ion-col>
      </ion-row>
    </ion-grid>

    <form [formGroup]="characterForm">
      <ion-grid style="margin: auto; width: 100%">
        <ion-row>
          <ion-col class="ion-text-left" size="9">
            <ion-label style="padding-left: 0.6em">Nome</ion-label>
            <ion-input
              formControlName="name"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
          <ion-col class="ion-text-left" size="3">
            <ion-label style="padding-left: 0.6em">Idade</ion-label>
            <ion-input
              formControlName="age"
              style="width: 100%; text-align: center"
              type="number"
            >
            </ion-input>
          </ion-col>
        </ion-row>

        <ion-row style="margin-top: 1em">
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em"
              >Local de nascimento</ion-label
            >
            <ion-input
              formControlName="birthplace"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em">Origem</ion-label>
            <ion-input
              formControlName="personality"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
        </ion-row>

        <ion-row style="margin-top: 1em">
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em">Classe</ion-label>
            <ion-input
              formControlName="charClass"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em">Deslocamento</ion-label>
            <ion-input
              formControlName="displacement"
              type="number"
              style="width: 100%; text-align: center"
            >
            </ion-input>
          </ion-col>
        </ion-row>

        <ion-row style="margin-top: 1em">
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em">Característica</ion-label>
            <ion-input
              formControlName="characteristic"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
          <ion-col class="ion-text-left" size="6">
            <ion-label style="padding-left: 0.6em">Jogador(a)</ion-label>
            <ion-input
              formControlName="player"
              style="width: 100%; text-indent: 12px"
            >
            </ion-input>
          </ion-col>
        </ion-row>

        <ion-row style="margin-top: 1em">
          <ion-col
            size="12"
            (click)="imagesModalIsOpen = true"
            style="
              border: 1px solid var(--ion-color-medium);
              background: #121212;
              border-radius: 16px;
            "
          >
            <ion-label
              style="
                padding-left: 0.6em;
                font-size: 1.1em;
                display: flex;
                align-items: center;
                justify-content: center;
              "
              color="light"
            >
              +<ion-icon
                name="image-outline"
                style="padding-right: 0.6em"
              ></ion-icon
              >{{selectedImage ? selectedImage : 'Selecionar imagem'}}</ion-label
            >
          </ion-col>
        </ion-row>

        <ion-row *ngIf="!editingMode">
          <ion-col>
            <ion-label
              color="light"
              style="font-family: SpecialFont; font-size: 1.8em"
            >
              Status
            </ion-label>
          </ion-col>
        </ion-row>

        <ion-row style="margin: 0.6em; width: 100%; margin: auto" *ngIf="!editingMode">
          <ion-col
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-danger-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-danger)"
              ></div>
              <span class="progress-text">
                <input placeholder="Vida" formControlName="max_life" />
              </span>
            </div>
          </ion-col>
          <ion-col
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-tertiary-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-tertiary)"
              ></div>
              <span class="progress-text">
                <input placeholder="Sanidade" formControlName="max_sanity" />
              </span>
            </div>
          </ion-col>
        </ion-row>
        <ion-row style="width: 100%; margin: auto" *ngIf="!editingMode">
          <ion-col
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-success-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-success)"
              ></div>
              <span class="progress-text">
                <input placeholder="Esforço" formControlName="max_effort" />
              </span>
            </div>
          </ion-col>
        </ion-row>

        <ion-row style="margin-top: 1em">
          <ion-col size="12">
            <ion-label style="padding-left: 0.6em">NEX</ion-label>
            <ion-input
              type="number"
              formControlName="nex"
              style="width: 100%; text-align: center"
            >
            </ion-input>
          </ion-col>
        </ion-row>
      </ion-grid>
    </form>

    <div style="position: fixed; bottom: 0; margin-bottom: 3em; width: 90%">
      <ion-button
        class="btn-outline"
        style="--background: none"
        shape="round"
        expand="block"
        slot="bottom"
        fill="clear"
        (click)="editingMode ? saveCharacterEdit() : createCharacter()"
      >
        Finalizar
      </ion-button>
    </div>

    <ion-modal [isOpen]="imagesModalIsOpen" (willDismiss)="imagesModalIsOpen= false">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Escolha uma imagem</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="imagesModalIsOpen = false">
                <ion-icon name="close"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <ion-grid>
            <ion-row>
              <div style="margin: auto; text-align: center">
              <ion-col *ngFor="let image of imagesArray">
                  <img
                    [src]="image.url"
                    (click)="selectImage(image.url, image.name)"
                    style="
                      max-width: 100px;
                      max-height: 160px;
                      min-width: 60px;
                      min-height: 160px;
                      margin: .5em
                    "
                  />
                </ion-col>
              </div>
            </ion-row>
          </ion-grid>
        </ion-content>
      </ng-template>
    </ion-modal>
  </div>
</ion-content>
