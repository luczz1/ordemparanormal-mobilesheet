<ion-content>
  <div class="menu" *ngIf="pageLoaded">
    <ion-grid>
      <div *ngFor="let attr of character">
        <ion-row>
          <ion-col style="display: flex; align-items: center">
            <ion-icon
              name="log-out-outline"
              color="danger"
              style="float: left; font-size: 1.1em"
              (click)="backToInitialScreen()"
            ></ion-icon>
            <span
              style="
                font-size: 1.3em;
                margin: auto;
                display: flex;
                align-items: center;
              "
              >{{attr.name}}
            </span>
            <ion-icon
              name="build-outline"
              style="float: right"
              (click)="gotoEditScreen(attr.id)"
            ></ion-icon>
          </ion-col>
        </ion-row>
        <ion-row style="margin: 0.6em; width: 100%; margin: auto">
          <ion-col
            (click)="openModal('life')"
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-danger-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-danger)"
                [style.width.%]="((attr.current_life / attr.max_life) * 100) > 100 ? 100 : ((attr.current_life / attr.max_life) * 100)"
              ></div>
              <span class="progress-text"
                >{{attr.current_life}} / {{attr.max_life}}</span
              >
            </div>
          </ion-col>
          <ion-col
            (click)="openModal('sanity')"
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-tertiary-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-tertiary)"
                [style.width.%]="((attr.current_sanity / attr.max_sanity) * 100) > 100 ? 100 : ((attr.current_sanity / attr.max_sanity) * 100)"
              ></div>
              <span class="progress-text"
                >{{attr.current_sanity}} / {{attr.max_sanity}}</span
              >
            </div>
          </ion-col>
        </ion-row>

        <ion-row style="width: 100%; margin: auto">
          <ion-col
            (click)="openModal('effort')"
            style="
              border-radius: 0.5em;
              margin: 0.4em;
              height: 1.5em;
              position: relative;
            "
          >
            <div
              class="progress-bar"
              style="background-color: var(--ion-color-success-shade)"
            >
              <div
                class="progress"
                style="background-color: var(--ion-color-success)"
                [style.width.%]="((attr.current_effort / attr.max_effort) * 100) > 100 ? 100 : ((attr.current_effort / attr.max_effort) * 100)"
              ></div>
              <span class="progress-text"
                >{{attr.current_effort}} / {{attr.max_effort}}</span
              >
            </div>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col class="ion-margin">
            <span
              style="
                font-size: 2.1em;
                color: var(--ion-color-light);
                font-family: SpecialFont;
              "
              >{{attr.class}}</span
            >
          </ion-col>
        </ion-row>

        <ion-row class="ion-align-items-center">
          <ion-col class="ion-text-center">
            <img
              [src]="attr.image_url"
              style="
                max-width: 400px;
                max-height: 400px;
                min-width: 150px;
                min-height: 400px;
              "
            />
          </ion-col>
        </ion-row>

        <ion-row style="width: 100%">
          <ion-col class="ion-text-left" style="font-size: 1.1em">
            <span>NEX: {{attr.nex}}</span>
          </ion-col>
          <ion-col class="ion-text-right" style="font-size: 1.1em">
            <span>{{attr.occupation}}</span>
          </ion-col>
        </ion-row>
        <ion-row style="width: 100%">
          <ion-col class="ion-text-left" style="font-size: 1.1em">
            <span
              >Carga:
              <ion-text
                [color]="generic.weightStatus === 'Normal' ? 'success' : 'danger'"
                >{{weightShow}}</ion-text
              ></span
            >
          </ion-col>
          <ion-col class="ion-text-right" style="font-size: 1.1em">
            <span>{{attr.path}}</span>
          </ion-col>
        </ion-row>
        <ion-row style="width: 100%">
          <ion-col class="ion-text-left" style="font-size: 1.1em">
            <span>{{attr.age}} anos</span>
          </ion-col>
          <ion-col class="ion-text-right" style="font-size: 1.1em">
            <span>Player: {{attr.player}}</span>
          </ion-col>
        </ion-row>

        <ion-row style="width: 100%">
          <ion-col class="ion-text-left" style="font-size: 1.1em">
            <span>{{attr.birthplace}}</span>
          </ion-col>
          <ion-col class="ion-text-right" style="font-size: 1.1em">
            <span
              >Deslocamento:
              <ion-text
                [color]="generic.weightStatus === 'Sobrecarga' ?
              'danger' : ''"
                >{{generic.weightStatus === 'Sobrecarga' ? (attr.displacement -
                3) : attr.displacement}}</ion-text
              ></span
            >
          </ion-col>
        </ion-row>
        <ion-row style="width: 100%">
          <ion-col
            class="ion-text-center"
            style="font-size: 1.1em"
            size="12"

          >
            <div style="justify-content: space-between; display: flex">
              <span (click)="gotoNotesOrAboutScreen('notes')"
                ><ion-icon
                  name="document-text-outline"
                  color="tertiary"
                ></ion-icon
              ></span>
              <span (click)="gotoNotesOrAboutScreen('about')"
                ><ion-icon
                  name="information-circle-outline"
                  color="warning"
                ></ion-icon
              ></span>
            </div>
          </ion-col>
        </ion-row>
      </div>
    </ion-grid>

    <ion-modal
      style="
        --height: 120px;
        --width: 300px;
        --border-radius: 40px;
        --background: #161616;
      "
      [isOpen]="openStatusModal"
      (willDismiss)="openStatusModal = false;"
    >
      <ng-template>
        <div style="margin: auto">
          <div style="text-align: center; margin-top: 0.6em">
            <ion-text
              [color]="modalType === 'life' ? 'danger' : modalType === 'sanity' ? 'tertiary' : 'success'"
              style="font-size: 1.1em"
              >{{modalType === 'life' ? 'Vida' : modalType === 'sanity' ?
              'Sanidade' : 'Esfor√ßo'}}</ion-text
            >
          </div>

          <div class="buttons" style="display: flex">
            <ion-button
              fill="clear"
              [color]="modalType === 'life' ? 'danger' : modalType === 'sanity' ? 'tertiary' : 'success'"
              (click)="increaseOrDecreaseCurrent(1, 'current')"
            >
              <ion-icon name="remove"></ion-icon>
            </ion-button>
            <ion-input
              type="number"
              [(ngModel)]="character[0]['current_' + modalType]"
              (input)="updateCharacterInDatabase()"
              [debounce]="200"
              style="width: 30px; text-align: center"
            ></ion-input>
            <ion-button
              fill="clear"
              [color]="modalType === 'life' ? 'danger' : modalType === 'sanity' ? 'tertiary' : 'success'"
              (click)="increaseOrDecreaseCurrent(0, 'current')"
            >
              <ion-icon name="add"></ion-icon>
            </ion-button>
            <ion-button
              fill="clear"
              [color]="modalType === 'life' ? 'danger' : modalType === 'sanity' ? 'tertiary' : 'success'"
              (click)="increaseOrDecreaseCurrent(1, 'max')"
            >
              <ion-icon name="remove"></ion-icon>
            </ion-button>
            <ion-input
              type="number"
              [(ngModel)]="character[0]['max_' + modalType]"
              (input)="updateCharacterInDatabase()"
              [debounce]="200"
              style="width: 30px; text-align: center"
            ></ion-input>
            <ion-button
              fill="clear"
              [color]="modalType === 'life' ? 'danger' : modalType === 'sanity' ? 'tertiary' : 'success'"
              (click)="increaseOrDecreaseCurrent(0, 'max')"
            >
              <ion-icon name="add"></ion-icon>
            </ion-button>
          </div>
        </div>
      </ng-template>
    </ion-modal>
  </div>
</ion-content>
